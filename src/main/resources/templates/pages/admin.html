<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="mainDecorator"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Administration</title>

    <style type="text/css">
        .order {
            margin-top: 1em;
            margin-bottom: 2em;
            background: #c0a7bcdd;
        }

        .order ul {
            list-style: circle;
        }

        .orderHeader {
            padding-top: 1em;
            font-size: 1.2em;
            font-weight: bolder;
        }

        .order input[type="checkbox"]:checked {
            color: blue;
        }

        .order input[type="checkbox"]:not(:checked) {
            color: red;
        }

        .orderLabel {
            font-weight: bolder;
            font-size: 0.9em;
            color: #ababab;
        }

        .summary ul {
            list-style: circle;
        }

        .orderPaid {
            color: inherit;
        }

        .orderNonPaid {
            color: #60071f;
        }

        .orderProcessed {
            color: inherit;
        }

        .orderNonProcessed {
            color: #60071f;
        }

        .orderButtons {
            padding: 0.7em;
        }

        .productHeader {
            margin: 0.2em;
            font-weight: bolder;
        }

        .productRow {
            /*border: solid 1px silver;*/
            margin: 0.2em;
        }

        .productRow input {
            width: 90%;
        }

        .productRow div {
            padding: 0.7em;
        }

        .errorArea{
            color: #b70000;
            font-weight: bolder;
            padding: 1em;
        }

    </style>

    <script type="text/javascript">
        function checkValues(productId) {

            console.log("check" + productId);

            var form = $("#form" + productId);
            var errorArea = $(".errorArea");
            var qtty = form.find("input[name='quantity']").val().trim();
            var price = form.find("input[name='price']").val().trim();

            function showError(htmlError) {
                errorArea.css("opacity", 0);
                errorArea.html(htmlError);
                errorArea.animate({"opacity": 1}, 800);
            }

            showError("");

            if (qtty.match(/^[0-9]+(\.[0-9]+)?$/i) === null) {
                showError("Quantité invalide: " + qtty + " (produit: " + productId + ")")
                return;
            }

            if (price.match(/^[0-9]+(\.[0-9]+)?$/i)  === null) {
                showError("Prix invalide: " + price + " (produit: " + productId + ")")
                return;
            }

            form.submit();
        }
    </script>

</head>
<body>
<div layout:fragment="content">

    <section id="courses" class="section-padding">

        <div class="container">

            <div class="row">
                <div class="header-section text-center">
                    <h2>Administration</h2>
                    <hr class="bottom-line"/>
                </div>
            </div>

            <div class="row">
                <div class="col-md-offset-1 col-md-10 text-left summary">
                    <ul>
                        <li><a href="#modifyProducts">Modifier les produits</a></li>
                        <li><a href="#lastNonProcessed">Dernières commandes non traitées</a></li>
                        <li><a href="#lastProcessed">Dernières commandes traitées</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <a name="modifyProducts"/>
        <h3 class="text-center">Modifier les produits</h3>

        <div class="container">
            <div class="row">
                <div class="col-sm-offset-1 col-sm-10 text-center">
                    <div class="errorArea">&nbsp;</div>
                </div>
            </div>

            <div class="row productHeader">
                <div class="col-sm-offset-1 col-sm-1">
                    ID
                </div>

                <div class="col-sm-2">
                    Nom
                </div>

                <div class="col-sm-2">
                    Quantité disponible
                </div>

                <div class="col-sm-2">
                    Prix unitaire
                </div>

            </div>

            <div class="row productRow" th:each="product : ${products}">
                <form method="get" th:id="${'form' + product.getId()}"
                      th:action="@{${mappings.get('ADMIN_MODIFICATION')}}">

                    <!-- product id -->
                    <div class="col-sm-offset-1 col-sm-1" th:text="${product.getId()}">
                        11
                    </div>

                    <!-- product name -->
                    <div class="col-sm-2" th:text="${product.getName()}">
                        Safran
                    </div>

                    <!-- quantity available -->
                    <div class="col-sm-2">
                        <input name="quantity" type="text" th:value="${product.getQuantityAvailable()}"/>
                    </div>

                    <!-- unit price -->
                    <div class="col-sm-2">
                        <input name="price" type="text" th:value="${product.getPrice()}"/>
                    </div>

                    <!-- modify button -->
                    <div class="col-sm-2">
                        <input type="hidden" name="action" value="product"/>
                        <input type="hidden" name="id" th:value="${product.getId()}"/>
                        <input type="button" value="Modifier" th:onClick="${'checkValues(' + product.getId() + ')'}"/>
                    </div>

                </form>
            </div>

        </div>


        <a name="lastNonProcessed"/>
        <h3 class="text-center">Dernières commandes non traitées</h3>
        <div th:replace="fragments/adminOrders :: adminOrders(orders=${ordersToProcess}, baskets=${basketsToProcess})">
            Orders to process
        </div>

        <a name="lastProcessed"/>
        <h3 class="text-center">Dernières commandes traitées</h3>
        <div th:replace="fragments/adminOrders :: adminOrders(orders=${ordersProcessed}, baskets=${basketsProcessed})">
            Orders processed
        </div>

    </section>

</div>
</body>
</html>