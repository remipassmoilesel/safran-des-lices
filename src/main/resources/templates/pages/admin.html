<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="mainDecorator"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Administration</title>

    <style type="text/css">
        .order {
            margin-top: 1em;
            margin-bottom: 2em;
            background: #c0a7bcdd;
        }

        .order ul {
            list-style: circle;
        }

        .orderHeader {
            padding-top: 1em;
            font-size: 1.2em;
            font-weight: bolder;
            margin-top: 1em;
            margin-bottom: 1em;
        }

        .order input[type="checkbox"]:checked {
            color: blue;
        }

        .order input[type="checkbox"]:not(:checked) {
            color: red;
        }

        .orderTable {
            width: 100%;
        }

        .orderTable td{
            vertical-align: top;
        }

        .orderLabel {
            font-weight: bolder;
            font-size: 0.9em;
            color: #484848;
        }

        .summary ul {
            list-style: circle;
        }

        .orderPaid {
            color: inherit;
        }

        .orderNonPaid {
            color: #60071f;
        }

        .orderProcessed {
            color: inherit;
        }

        .orderNonProcessed {
            color: #60071f;
        }

        .orderButtons {
            padding: 0.7em;
        }

        .productHeader {
            margin: 0.2em;
            font-weight: bolder;
        }

        .productRow {
            /*border: solid 1px silver;*/
            margin: 0.2em;
        }

        .productRow input {
            width: 90%;
        }

        .productRow div {
            padding: 0.7em;
        }

        .productErrorArea {
            color: #b70000;
            font-weight: bolder;
            padding: 1em;
        }

        .expenseErrorArea {
            color: #b70000;
            font-weight: bolder;
            padding: 1em;
        }

        .orderWarn {
            font-weight: bolder;
            text-align: center;
            width: 70%;
            margin: auto;
            margin-top: 1em;
            margin-bottom: 1em;
        }

        h3 {
            margin-top: 3em;
        }

    </style>

    <script type="text/javascript">
        function checkProduct(productId) {

            console.log("check product" + productId);

            var form = $("#productForm" + productId);
            var errorArea = $(".productErrorArea");
            var qtty = form.find("input[name='quantity']").val().trim();
            var price = form.find("input[name='price']").val().trim();

            function showError(htmlError) {
                errorArea.css("opacity", 0);
                errorArea.html(htmlError);
                errorArea.animate({"opacity": 1}, 800);
            }

            showError("");

            if (qtty.match(/^[0-9]+(\.[0-9]+)?$/i) === null) {
                showError("Quantité invalide: " + qtty + " (produit: " + productId + ")");
                return;
            }

            if (price.match(/^[0-9]+(\.[0-9]+)?$/i) === null) {
                showError("Prix invalide: " + price + " (produit: " + productId + ")");
                return;
            }

            form.submit();
        }

        function checkExpense(expenseId) {

            console.log("check product" + expenseId);

            var form = $("#expenseForm" + expenseId);
            var errorArea = $(".expenseErrorArea");
            var qtty = form.find("input[name='name']").val().trim();
            var price = form.find("input[name='value']").val().trim();

            function showError(htmlError) {
                errorArea.css("opacity", 0);
                errorArea.html(htmlError);
                errorArea.animate({"opacity": 1}, 800);
            }

            showError("");

            if (qtty.match(/^.{5,50}$/i) === null) {
                showError("Nom invalide: " + qtty + " (frais: " + expenseId + ")");
                return;
            }

            if (price.match(/^[0-9]+(\.[0-9]+)?$/i) === null) {
                showError("Valeur invalide: " + price + " (frais: " + expenseId + ")");
                return;
            }

            form.submit();
        }
    </script>

</head>
<body>
<div layout:fragment="content">

    <section id="courses" class="section-padding">

        <div class="container">

            <div class="row">
                <div class="header-section text-center">
                    <h2>Administration</h2>
                    <hr class="bottom-line"/>
                </div>
            </div>

            <div>
                <div class="orderWarn">
                    Attention: avant d'envoyer une commande vérifiez toujours la bonne
                    réception du paiement, même si il apparait confirmé ci-dessous.
                </div>
            </div>

            <div class="row">
                <div class="col-md-offset-1 col-md-10 text-left summary">
                    <ul>
                        <li><a href="#modifyProducts">Modifier les produits</a></li>
                        <li><a href="#modifyExpenses">Modifier les frais</a></li>
                        <li><a href="#lastNonProcessed">Dernières commandes non traitées</a></li>
                        <li><a href="#lastProcessed">Dernières commandes traitées</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <a name="modifyProducts"/>
        <h3 class="text-center">Modifier les produits</h3>

        <div class="container">
            <div class="row">
                <div class="col-sm-offset-1 col-sm-10 text-center">
                    <div class="productErrorArea">&nbsp;</div>
                </div>
            </div>

            <div class="row productHeader">
                <div class="col-sm-offset-1 col-sm-1">
                    ID
                </div>

                <div class="col-sm-2">
                    Nom
                </div>

                <div class="col-sm-2">
                    Quantité disponible
                </div>

                <div class="col-sm-2">
                    Prix unitaire
                </div>

            </div>

            <div class="row productRow text-center" th:if="${#lists.size(products) lt 1}">
                <i>Aucun produit à afficher</i>
            </div>

            <div class="row productRow" th:each="product : ${products}" th:if="${#lists.size(products) gt 0}">
                <form method="get" th:id="${'productForm' + product.getId()}"
                      th:action="@{${mappings.get('ADMIN_MODIFICATION')}}">

                    <!-- product id -->
                    <div class="col-sm-offset-1 col-sm-1" th:text="${product.getId()}">
                        11
                    </div>

                    <!-- product name -->
                    <div class="col-sm-2" th:text="${product.getName()}">
                        Safran
                    </div>

                    <!-- quantity available -->
                    <div class="col-sm-2">
                        <input name="quantity" type="text" th:value="${product.getQuantityAvailable()}"/>
                    </div>

                    <!-- unit price -->
                    <div class="col-sm-2">
                        <input name="price" type="text" th:value="${product.getPrice()}"/>
                    </div>

                    <!-- modify button -->
                    <div class="col-sm-2">
                        <input type="hidden" name="action" value="product"/>
                        <input type="hidden" name="id" th:value="${product.getId()}"/>
                        <input type="button" value="Modifier" th:onClick="${'checkProduct(' + product.getId() + ')'}"/>
                    </div>

                </form>
            </div>

        </div>

        <a name="modifyExpenses"/>
        <h3 class="text-center">Modifier les frais</h3>

        <div class="container">
            <div class="row">
                <div class="col-sm-offset-1 col-sm-10 text-center">
                    <div class="expenseErrorArea">&nbsp;</div>
                </div>
            </div>

            <div class="row productRow text-center" th:if="${#lists.size(expenses) lt 1}">
                <i>Aucun frais à afficher</i>
            </div>

            <div class="row productHeader" th:if="${#lists.size(expenses) gt 0}">
                <div class="col-sm-offset-1 col-sm-1">
                    ID
                </div>

                <div class="col-sm-4">
                    Nom
                </div>

                <div class="col-sm-2">
                    Valeur
                </div>

            </div>

            <div class="row productRow" th:each="expense : ${expenses}" th:if="${#lists.size(expenses) gt 0}">
                <form method="get" th:id="${'expenseForm' + expense.getId()}"
                      th:action="@{${mappings.get('ADMIN_MODIFICATION')}}">

                    <!-- expense id -->
                    <div class="col-sm-offset-1 col-sm-1" th:text="${expense.getId()}">
                        11
                    </div>

                    <!-- expense name -->
                    <div class="col-sm-4">
                        <input name="name" type="text" th:value="${expense.getName()}"/>
                    </div>

                    <!-- expense price -->
                    <div class="col-sm-2">
                        <input name="value" type="text" th:value="${expense.getValue()}"/>
                    </div>

                    <!-- modify button -->
                    <div class="col-sm-2">
                        <input type="hidden" name="action" value="expense"/>
                        <input type="hidden" name="id" th:value="${expense.getId()}"/>
                        <input type="button" value="Modifier" th:onClick="${'checkExpense(' + expense.getId() + ')'}"/>
                    </div>

                </form>
            </div>

        </div>


        <a name="lastNonProcessed"/>
        <h3 class="text-center">Dernières commandes non traitées</h3>
        <div th:replace="fragments/adminOrders :: adminOrders(orders=${ordersToProcess}, baskets=${basketsToProcess})">
            Orders to process
        </div>

        <a name="lastProcessed"/>
        <h3 class="text-center">Dernières commandes traitées</h3>
        <div th:replace="fragments/adminOrders :: adminOrders(orders=${ordersProcessed}, baskets=${basketsProcessed})">
            Orders processed
        </div>

    </section>

</div>
</body>
</html>